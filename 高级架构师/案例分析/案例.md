# 案例

体系结构权衡分析法（ATAM）

质量属性效用树

## 软件质量属性是影响软件架构设计的重要因素。请用 200 字以内的文字列举六种不同的软件质量属性名称，并解释其含义

性能（Performance）、可用性（Availability）、可靠性（Reliability）、健壮性（Robustness）、安全性（Security）、可修改性（Modification）、可变性（Changeability）、易用性（Usability）、可测试性（Testability）、功能性（Functionality）和互操作性（Inter-operation）

- 性能是指系统的响应能力，即要经过多长时间才能对某个事件做出响应，或者在某段时间内系统所能处理事件的个数
- 可用性是系统能够正常运行的时间比例
- 可靠性是指软件系统在应用或错误面前，在意外或错误使用的情况下维持软件系统功能特性的基本能力
- 健壮性是指在处理或环境中，系统能够承受压力或变更的能力
- 安全性是指系统向合法用户提供服务的同时能够阻止非授权用户使用的企图或拒绝服务的能力
- 可修改性是指能够快速地以较高的性能价格比对系统进行变更的能力
- 可变性是指体系结构经扩充或变更成为新体系结构的能力
- 易用性是衡量用户使用一个软件产品完成指定任务的难易程度
- 可测试性是指软件发现故障并隔离、定位其故障的能力特性，以及在一定的时间和成本前提下，进行测试设计、测试执行的能力
- 功能性是系统所能完成所期望工作的能力
- 互操作性是指系统与外界或系统与系统之间的相互作用能力

## 某软件开发公司欲为某电子商务企业开发一个在线交易平台，支持客户完成网上购物活动中的在线交易

在系统开发之初，企业对该平台提出了如下要求

- 在线交易平台必须在 1s 内完成客户的交易请求
- 该平台必须保证客户个人信息和交易信息的安全
- 当发生故障时，该平台的平均故障恢复时间必须小于 10s
- 由于企业业务发展较快，需要经常为该平台添加新功能或进行硬件升级。添加新功能或进行硬件升级必须在 6 小时内完成

针对这些要求，该软件开发公司决定采用基于架构的软件开发方法，以架构为核心进行在线交易平台的设计与实现？

- 在线交易平台必须在 1s 内完成客户的交易请求。该要求主要对应性能，可以采用的架构设计策略有增加计算资源、改善资源需求（减少计算复杂度等）、资源管理（并发、数据复制等）和资源调度（先进先出队列、优先级队列等）
- 该平台必须严格保证客户个人信息和交易信息的保密性和安全性。该要求主要对应安全性，可以采用的架构设计策略有抵御攻击（授权、认证和限制访问等）、攻击检测（入侵检测等）、从攻击中恢复（部分可用性策略）和信息审计等
- 当发生故障时，该平台的平均故障恢复时间必须小于 l0s。该要求主要对应可用性，可以采用的架构设计策略有 Ping/Echo、心跳、异常和主动冗余等
- 由于企业业务发展较快，需要经常为该平台添加新功能或进行硬件升级。添加新功能或进行平台升级必须在 6 小时内完成。该要求主要对应可修改性，可以采用的架构设计策略有软件模块泛化、限制模块之间通信、使用中介和延迟绑定等

## 微服务的介绍，并说明微服务的优缺点

微服务架构（Microservices Architecture）是一种将单体应用拆解为一组小型、独立部署的服务单元的架构模式。每个服务：

- 职责单一：专注于完成一个特定业务功能（如用户管理、订单处理等）
- 独立运行：拥有独立的代码库、运行进程和数据存储
- 轻量级通信：通过 HTTP/REST、消息队列（如 Kafka）等机制实现服务间通信
- 技术异构：各服务可根据需求选择不同的编程语言、框架和数据库

### 核心设计原则

- 单一职责原则（SRP）：每个服务仅负责一个业务能力
- 去中心化治理：无集中式服务管理节点，强调自治和分布式协作
- 容错性设计：通过熔断、重试等机制保障服务稳定性
- 基础设施自动化：借助容器化（Docker）、编排工具（Kubernetes）实现快速部署与扩展

### 微服务架构的优点

#### 高可扩展性

- 独立扩展：可针对瓶颈服务（如支付模块）单独扩容，无需整体升级
- 技术选型灵活：不同服务可采用最适合的技术栈（如 Java 处理业务逻辑、Go 实现高并发接口）

#### 低耦合与高容错性

- 服务隔离：单个服务故障不会导致整个系统崩溃，通过熔断机制隔离问题
- 故障定位清晰：问题可快速定位到具体服务，便于排查和修复

#### 敏捷开发与持续交付

- 小团队协作高效：每个服务可由独立团队开发、测试和部署，加速迭代
- 快速发布：支持灰度发布、蓝绿部署等模式，降低变更风险

#### 技术演进灵活

- 渐进式重构：无需一次性重写整个系统，可逐步将单体应用拆分为微服务
- 适应新技术：局部引入新技术（如 AI、区块链）而不影响整体架构

#### 资源利用率优化

- 按需分配资源：根据服务负载动态调整资源（如 Kubernetes 的自动扩缩容），降低成本

### 微服务架构的缺点

#### 分布式系统复杂性剧增

- 网络通信风险：服务间调用引入延迟、超时、网络分区等问题，需实现熔断（如 Hystrix）、限流（如 Sentinel）等机制
- 分布式事务处理：跨服务数据一致性难以保证，需依赖最终一致性方案（如事务消息、TCC 模式）

#### 运维与管理成本高

服务数量爆炸：数十甚至数百个服务需管理，依赖服务发现（如 Consul）、配置中心（如 Spring Cloud Config）等基础设施
监控与日志复杂：需分布式追踪（如 Jaeger）和日志聚合（如 ELK Stack），否则难以定位跨服务问题

#### 接口兼容性与版本管理难题

服务契约管理：接口变更可能影响下游服务，需制定严格的版本控制策略（如 RESTful API 的版本号设计）
集成测试复杂度高：需模拟多服务协同场景，测试环境搭建和维护成本高

#### 开发门槛提升

技术栈碎片化：团队需掌握分布式架构、容器化、消息队列等多项技术，对开发者要求较高
调试难度大：跨服务调用链的调试需依赖专业工具，难以通过单节点日志定位问题

#### 成本权衡问题

初期投入大：需建设 DevOps 流水线、容器云平台等基础设施，小型项目可能得不偿失
资源消耗增加：每个服务独立运行，内存、CPU 等资源总消耗可能高于单体架构
